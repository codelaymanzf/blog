# Diff Algorithm

## diff 策略

- 同级比较， Web UI 中 DOM 节点跨层级的移动操作特别少，可以忽略不计。
- 拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构
- 开发者可以通过`key` prop 来暗示哪些子元素在不同的渲染下能保持稳定

## diff 过程

**比对两个虚拟 DOM 时会有三种操作：删除、替换、更新**

- 删除：newVnode 不存在时
- 替换：vnode 和 newVnode 类型不同或者 key 不同
- **更新**：有相同类型和 key，但 vnode 和 newVnode 不同

## 更新操作

**根据组件类型执行不同更新操作**

- class 类型组件
- 函数类型组件
- 元素类型

## patch 过程

> 虚拟 DOM 比对，最终要转换为对应 patch 操作

- 属性更新
- 子元素更新

## patchChildren 过程

- 老节点是空的，新节点是空的，什么都不需要作
- 老节点是空的，新节点是单个
- 老节点是空的，新节点是多个
- 老节点是单个，新节点是空的
- 老节点是单个，新节点是单个
- 老节点是单个，新节点是多个
- 老节点是多个，新节点是空的
- 老节点是多个，新节点是单个
- **老节点是多个，新节点是多个** (abcd->dabef)
  - 新增：老节点中没有，新节点中有，则需要新增(如 e、f)
  - 删除：老节点中有，新节点中没有（如 c)
  - `复用：相同的type和key,那就需要patch更新属性、判断位置是否需要移动`(如 a、b、d)
